<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.silver.shelter.admin.model.mapper.AdminMapper">


	

	<!-- <typeAlias alias="member" type="silverShelter.member.model.dto.Member"/> -->
	
	<!-- 탈퇴하지 않은 회원 수 조회 -->
	<select id="memberAllCount">
		SELECT COUNT(*)
		FROM MEMBER
		WHERE MEMBER_DEL_FL = 'N'
	</select>


	<!-- 탈퇴하지 않았고 검색조건에 맞는 회원 수 조회 -->
	<select id="memberSearchCount">
		SELECT COUNT(*)
		FROM "MEMBER"
		WHERE MEMBER_DEL_FL = 'N'
		
		<choose>
			
			<!-- 이름 검색 -->
			<when test='key == "n"'>
				AND MEMBER_NAME LIKE '%' || #{query} || '%'
			</when>
			
			<!-- 아이디 검색 -->
			<when test='key == "i"'>
				AND MEMBER_ID LIKE '%' || #{query} || '%'
			</when>
			
		</choose>
	</select>



	<!-- 회원 목록 조회 / 검색 X -->
	<select id="memberAllSelect">
		SELECT MEMBER_NAME, MEMBER_ID, MEMBER_NO, EXAM_STATUS,
		TO_CHAR(EXAM_DATE, 'YYYY"."MM"."DD  HH24":"MI":"SS') EXAM_DATE
		FROM "MEMBER"
		JOIN "EXAMINATION" USING(EXAM_ID)
		WHERE MEMBER_ROLE = 2 <!-- 2 : 회원 -->
		ORDER BY MEMBER_NO DESC
	</select>

	
	<select id="memberSearchSelect">
		SELECT MEMBER_NAME, MEMBER_ID, MEMBER_NO, EXAM_STATUS
		FROM "MEMBER"
		JOIN "EXAMINATION" USING(EXAM_ID)
		WHERE MEMBER_ROLE = 2 <!-- 2 : 회원 -->
		
		<choose>
			
			<!-- 이름 검색 -->
			<when test='key == "n"'>
				AND MEMBER_NAME LIKE '%' || #{query} || '%'
			</when>
			
			<!-- 아이디 검색 -->
			<when test='key == "i"'>
				AND MEMBER_ID LIKE '%' || #{query} || '%'
			</when>
			
		</choose>
		
		ORDER BY MEMBER_NO DESC
	</select>
	
	
	<select id="adminDetailSelect" resultType="Member">
		SELECT MEMBER_NO, MEMBER_NAME, MEMBER_ID, MEMBER_PW,
			MEMBER_EMAIL, MEMBER_ADDRESS, MEMBER_TEL,
			GUARDIAN_TEL, CAREGIVERS_NAME
		FROM "MEMBER"
		LEFT JOIN "CAREGIVERS" USING(CAREGIVERS_NO)
		WHERE MEMBER_NO = #{memberNo}
	</select>


	<!-- 심사 서류 관리 페이지 게시글 수 조회X -->
	<select id="examinationAllCount">
		SELECT COUNT(*)
		FROM "EXAMINATION"
		WHERE EXAM_STATUS = 'N'
	</select>
	
	
	
	
	<!-- 심사 서류 관리 페이지 전체 게시글 조회하기 (승인여부가 N이고 심사고유번호가 낮을수록 상단에 출력됨  -->
	<select id="examinationAllSelect">
		SELECT EXAM_ID, EXAM_NAME, EXAM_EMAIL, EXAM_ROOM_TYPE || '/' || EXAM_ROOM_CAPACITY AS EXAM_ROOM,
			EXAM_STATUS, EXAM_DATE
		FROM "EXAMINATION"
		WHERE EXAM_STATUS = 'N'
		ORDER BY EXAM_STATUS, EXAM_ID <!-- 승인여부 : N, 심사고유번호 -->
	</select>
	
	
	<!-- 심사 서류 관리 페이지 게시글 수 조회O -->
	<select id="examinationSearchCount">
		SELECT COUNT(*)
		FROM "EXAMINATION"
		WHERE EXAM_STATUS = 'N'
		<choose>
			
			<!-- 이름으로 검색 -->
			<when test='key == "n"'>
				AND EXAM_NAME LIKE '%' || #{query} || '%'
			</when>
			
			<!-- 이메일으로 검색 -->
			<when test='key == "n"'>
				AND EXAM_EMAIL LIKE '%' || #{query} || '%'
			</when>
			
			
		</choose>
	</select>
	
	
	<!-- 심사 서류 관리 페이지 검색한 게시글 조회하기 -->
	<select id="examinationSearchSelect">
		SELECT EXAM_ID, EXAM_NAME, EXAM_EMAIL, EXAM_ROOM_TYPE || '/' || EXAM_ROOM_CAPACITY AS EXAM_ROOM,
			EXAM_STATUS, EXAM_DATE
		FROM "EXAMINATION"
		WHERE EXAM_STATUS = 'N'
		<choose>
			
			<!-- 이름으로 검색 -->
			<when test='key == "n"'>
				AND EXAM_NAME LIKE '%' || #{query} || '%'
			</when>
			
			<!-- 이메일으로 검색 -->
			<when test='key == "e"'>
				AND EXAM_EMAIL LIKE '%' || #{query} || '%'
			</when>
			
			
			
		</choose>
		ORDER BY EXAM_ID
	</select>
	
	
	<!-- 심사 서류 관리 상세 조회 -->
	<select id="examinationDetailSelect" resultType="Examination">
		SELECT EXAM_ID, EXAM_NAME, EXAM_EMAIL, EXAM_PHONE,
			EXAM_STATUS, EXAM_DATE, EXAM_ROOM_TYPE || '/' || EXAM_ROOM_CAPACITY AS EXAM_ROOM
		FROM "EXAMINATION"
		WHERE EXAM_ID = #{examId}
	</select>
	
	
	<update id="updateAdminDocument">
			UPDATE EXAMINATION
			SET EXAM_STATUS = 'Y'
			WHERE EXAM_ID = #{examId}
	
	</update>
	
	
	
	
	
	
	<!-- 요양사 수 전체 조회 -->
	<select id="caregiversAllCount">
		SELECT COUNT(*)
		FROM "CAREGIVERS"
	</select>
	
	
	<!-- 요양사 데이터 전체 조회 -->
	<select id="caregiversAllSelect">
		SELECT *
		FROM "CAREGIVERS"
	</select>
	
	
	<select id="caregiversSearchCount">
		SELECT COUNT(*)
		FROM CAREGIVERS
		WHERE
		<choose>
			<when test='key == "name"'>
				CAREGIVERS_NAME LIKE '%' || #{query} || '%'
			</when>
			
			<when test='key == "experience"'>
				CAREGIVERS_EXPERIENCE = #{query}
			</when>
			
			<when test='key == "workHours"'>
				CAREGIVERS_WORK_HOURS = #{query}
			</when>
			
			<when test='key == "jobDuties"'>
				CAREGIVERS_ROLE = #{query}
			</when>
		</choose>
	</select>
	
	
	<select id="caregiversSearchSelect">
		SELECT *
		FROM CAREGIVERS
		WHERE
		<choose>
			<when test='key == "name"'>
				CAREGIVERS_NAME LIKE '%' || #{query} || '%'
			</when>
			
			<when test='key == "experience"'>
				CAREGIVERS_EXPERIENCE = #{query}
			</when>
			
			<when test='key == "workHours"'>
				CAREGIVERS_WORK_HOURS = #{query}
			</when>
			
			<when test='key == "jobDuties"'>
				CAREGIVERS_ROLE = #{query}
			</when>
		</choose>
	</select>
	
	
	<!-- 요양사 상세조회 -->
	<select id="caregiversDetailSelect">
		SELECT *
		FROM CAREGIVERS
		WHERE CAREGIVERS_NO = #{caregiversNo}
	</select>

	
	

</mapper>