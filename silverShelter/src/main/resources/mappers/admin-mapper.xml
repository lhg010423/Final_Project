<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.silver.shelter.admin.model.mapper.AdminMapper">


	

	<!-- <typeAlias alias="member" type="silverShelter.member.model.dto.Member"/> -->
	
	<!-- 탈퇴하지 않은 회원 수 조회 -->
	<select id="memberAllCount">
		SELECT COUNT(*)
		FROM MEMBER
		WHERE MEMBER_DEL_FL = 'N'
	</select>


	<!-- 탈퇴하지 않았고 검색조건에 맞는 회원 수 조회 -->
	<select id="memberSearchCount">
		SELECT COUNT(*)
		FROM "MEMBER"
		WHERE MEMBER_DEL_FL = 'N'
		
		<choose>
			
			<!-- 이름 검색 -->
			<when test='key == "n"'>
				AND MEMBER_NAME LIKE '%' || #{query} || '%'
			</when>
			
			<!-- 아이디 검색 -->
			<when test='key == "i"'>
				AND MEMBER_ID LIKE '%' || #{query} || '%'
			</when>
			
		</choose>
	</select>



	<!-- 회원 목록 조회 / 검색 X -->
	<select id="memberAllSelect">
		SELECT MEMBER_NAME, MEMBER_ID, MEMBER_NO
		FROM "MEMBER"
		WHERE MEMBER_ROLE = 2 <!-- 2 : 회원 -->
		ORDER BY MEMBER_NO DESC
	</select>

	
	<select id="memberSearchSelect">
		SELECT MEMBER_NAME, MEMBER_ID, MEMBER_NO
		FROM "MEMBER"
		WHERE MEMBER_ROLE = 2 <!-- 2 : 회원 -->
		
		<choose>
			
			<!-- 이름 검색 -->
			<when test='key == "n"'>
				AND MEMBER_NAME LIKE '%' || #{query} || '%'
			</when>
			
			<!-- 아이디 검색 -->
			<when test='key == "i"'>
				AND MEMBER_ID LIKE '%' || #{query} || '%'
			</when>
			
		</choose>
		
		ORDER BY MEMBER_NO DESC
	</select>
	
	
	<select id="adminDetailSelect">
		SELECT MEMBER_NAME, MEMBER_ID, MEMBER_PW,
			MEMBER_EMAIL, MEMBER_ADDRESS, MEMBER_TEL,
			GUARDIAN_TEL, ROOM_NO, CAREGIVERS_NAME
		FROM "MEMBER"
		JOIN "CAREGIVERS" USING(CAREGIVERS_NO)
		WHERE MEMBER_NO = #{memberNo}
	</select>
	
	

</mapper>